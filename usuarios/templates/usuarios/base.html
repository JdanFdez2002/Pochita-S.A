{% load static %}
<!doctype html>
<html lang="es">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Dashboard | Pochita S.A{% endblock %}</title>
    <link rel="stylesheet" href="{% static 'usuarios/dashboard.css' %}">
    {% block extra_head %}{% endblock %}
</head>
<body class="dashboard">
    <div class="layout">
        <aside class="sidebar">
            <div class="brand">Pochita</div>
            <nav class="menu">
                {% block sidebar_menu %}
                {# agregar aqui el enlace a el otro html - aqui va el nombre del bot√≥n #}
                {% endblock %}
            </nav>
        </aside>
        <main class="content">
            {% block dashboard_content %}{% endblock %}
        </main>
    </div>
    {% block extra_js %}{% endblock %}
    <script>
    // Toggle secciones por data-target; muestra solo la seleccionada.
    (function() {
        const links = document.querySelectorAll(".menu a[data-target]");
        const sections = document.querySelectorAll(".dashboard-section");
        function showSection(id, { updateHash = true } = {}) {
            sections.forEach(sec => {
                sec.classList.toggle("is-active", sec.id === id);
            });
            links.forEach(link => {
                link.classList.toggle("is-active", link.dataset.target === id);
            });
            if (updateHash) {
                try {
                    window.location.hash = id;
                } catch (e) {
                    /* ignore */
                }
            }
        }
        links.forEach(link => {
            link.addEventListener("click", (e) => {
                e.preventDefault();
                const target = link.dataset.target;
                if (target) showSection(target);
            });
        });
        const hash = (window.location.hash || "").replace("#", "");
        const hasHashSection = hash && document.getElementById(hash);
        const first = links.length ? links[0].dataset.target : null;
        const initial = hasHashSection ? hash : first;
        if (initial) showSection(initial, { updateHash: false });
    })();

    // Manejo de formularios de perfil: vista solo lectura, editar, confirmar o cancelar.
    (function() {
        const forms = document.querySelectorAll(".profile-form");
        forms.forEach(form => {
            const fields = form.querySelectorAll("[data-editable]");
            const editableFields = form.querySelectorAll("[data-editable]:not([data-locked])");
            const lockedFields = form.querySelectorAll("[data-locked]");
            const editBtn = form.querySelector("[data-action='edit']");
            const cancelBtn = form.querySelector("[data-action='cancel']");
            const submitBtn = form.querySelector("[data-action='submit']");
            const hasErrors = form.dataset.hasErrors === "1";
            const originals = new Map();
            fields.forEach(field => originals.set(field.name, field.value));

            function setEditable(enabled) {
                editableFields.forEach(field => {
                    field.disabled = !enabled;
                });
                lockedFields.forEach(field => {
                    field.disabled = true;
                });
                if (submitBtn) submitBtn.disabled = !enabled;
                if (cancelBtn) cancelBtn.disabled = !enabled;
                if (editBtn) editBtn.disabled = enabled;
                form.classList.toggle("is-editing", enabled);
            }

            function resetValues() {
                originals.forEach((value, name) => {
                    const field = form.querySelector(`[name='${name}']`);
                    if (field) field.value = value;
                });
            }

            if (hasErrors) {
                setEditable(true);
            } else {
                setEditable(false);
            }

            if (editBtn) {
                editBtn.addEventListener("click", (event) => {
                    event.preventDefault();
                    setEditable(true);
                });
            }
            if (cancelBtn) {
                cancelBtn.addEventListener("click", (event) => {
                    event.preventDefault();
                    resetValues();
                    setEditable(false);
                });
            }
            form.addEventListener("submit", () => {
                // aseguramos que los campos viajen habilitados al backend
                editableFields.forEach(field => field.disabled = false);
            });
        });
    })();
    </script>
</body>
</html>
